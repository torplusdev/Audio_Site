(function ($) {
	"use strict";
	
	$(document).ready(function () {
		qodefFullscreenMenu.init();
	});
	
	var qodefFullscreenMenu = {
		init: function () {
			var $fullscreenMenuOpener = $('a.qodef-fullscreen-menu-opener'),
				$menuItems 	     = $('#qodef-fullscreen-area nav ul li a'),
				$menuItemsParent = $('#qodef-fullscreen-area nav > ul > li > a');

			//Appearing animation
			$menuItemsParent.each(function(i) {
				var $animationDelay = (i+1) * 70 + 'ms';
				$(this).css({
					'-webkit-animation-delay': $animationDelay,
					'-moz-animation-delay': $animationDelay,
					'animation-delay': $animationDelay
				});
				$(this).next('.qodef-drop-down-second').css({
					'-webkit-animation-delay': $animationDelay,
					'-moz-animation-delay': $animationDelay,
					'animation-delay': $animationDelay
				});
			});
			
			// Open popup menu
			$fullscreenMenuOpener.on('click', function (e) {
				e.preventDefault();
				var $thisOpener = $(this);
				
				if (!qodefCore.body.hasClass('qodef-fullscreen-menu--opened')) {
					qodefFullscreenMenu.openFullscreen($thisOpener);
					
					$(document).keyup(function (e) {
						if (e.keyCode === 27) {
							qodefFullscreenMenu.closeFullscreen($thisOpener);
						}
					});
				} else {
					qodefFullscreenMenu.closeFullscreen($thisOpener);
				}
			});
			
			//open dropdowns
			$menuItems.on('tap click', function (e) {
				var $thisItem = $(this);
				
				if ($thisItem.parent().hasClass('menu-item-has-children')) {
					e.preventDefault();
					qodefFullscreenMenu.clickItemWithChild($thisItem);
				} else if ($thisItem.attr('href') !== "http://#" && $thisItem.attr('href') !== "#") {
					qodefFullscreenMenu.closeFullscreen($fullscreenMenuOpener);
				}
			});
		},
		openFullscreen: function ($opener) {
			$opener.addClass('qodef--opened');
			qodefCore.body.removeClass('qodef-fullscreen-menu-animate--out').addClass('qodef-fullscreen-menu--opened qodef-fullscreen-menu-animate--in');
			qodefCore.qodefScroll.disable();
		},
		closeFullscreen: function ($opener) {
			$opener.removeClass('qodef--opened');
			qodefCore.body.removeClass('qodef-fullscreen-menu--opened qodef-fullscreen-menu-animate--in').addClass('qodef-fullscreen-menu-animate--out');
			qodefCore.qodefScroll.enable();
			$("nav.qodef-fullscreen-menu ul.sub_menu").slideUp(200);
		},
		clickItemWithChild: function (thisItem) {
			var $thisItemParent = thisItem.parent(),
				$thisItemSubMenu = $thisItemParent.find('.sub-menu').first();
			
			if ($thisItemSubMenu.is(':visible')) {
				$thisItemSubMenu.slideUp(300);
				$thisItemParent.removeClass('qodef--opened');
			} else {
				$thisItemSubMenu.slideDown(300);
				$thisItemParent.addClass('qodef--opened').siblings().find('.sub-menu').slideUp(400);
			}
		}
	};
	
})(jQuery);
